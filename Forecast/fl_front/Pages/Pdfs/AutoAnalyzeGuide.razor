@page "/auto-analyze-guide"
@inject fl_front.Interfaces.IPdfAnalysisServiceF PdfServiceF

<h3>Análisis Automático de Guía de Laboratorio</h3>

<div class="mb-3">
    <label class="form-label">Modelo</label>
    <select class="form-select" @bind="modelo">
        <option value="gpt-4o">GPT-4o</option>
        <option value="gpt-4">GPT-4</option>
        <option value="gpt-3.5-turbo">GPT-3.5</option>
    </select>
</div>

<div class="mb-3">
    <label class="form-label">Archivo PDF</label>
    <InputFile OnChange="HandleFileChange" accept="application/pdf" />
</div>

<button class="btn btn-primary" @onclick="SubirYAnalizar" disabled="@(archivo == null || string.IsNullOrEmpty(modelo))">
    Analizar Guía
</button>

@if (!string.IsNullOrWhiteSpace(resultado))
{
    <div class="alert alert-info mt-3">
        <pre>@resultado</pre>
    </div>
}

@code {
    private IBrowserFile? archivo;
    private string modelo = "gpt-4o";
    private string resultado = string.Empty;

    private void HandleFileChange(InputFileChangeEventArgs e)
    {
        archivo = e.File;
        resultado = string.Empty;
    }

    private async Task SubirYAnalizar()
    {
        if (archivo == null) return;
        resultado = await PdfServiceF.AnalyzePdfGuideAsync(archivo, modelo);
    }
}
